(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{174:function(e,t,n){e.exports={content:"TopicItem_content__1paU7"}},175:function(e,t,n){e.exports={topic:"Topic_topic__2D3q7"}},178:function(e,t,n){e.exports=n(309)},267:function(e,t,n){},309:function(e,t,n){"use strict";n.r(t);var o=n(1),r=n.n(o),a=n(24),i=n.n(a),c=n(22),s=n(83),l=(n(265),n(267),n(17)),u=n(27),d=n(20),p=n(18),h=n(19),f=(n(269),n(275),n(35)),m=n(60),g=n(169),v=n.n(g),b=n(12),w=n(176),E=n(177),O=n(170),j=n.n(O),y={},k=1e4,T=0;var P=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"string"===typeof t&&(t={path:t});var n=t,o=n.exact,r=void 0===o||o,a=n.strict,i=void 0!==a&&a,c=n.sensitive,s=void 0!==c&&c;return[].concat(t.path).reduce(function(t,n){if(t)return t;var o=function(e,t){var n="".concat(t.end).concat(t.strict).concat(t.sensitive),o=y[n]||(y[n]={});if(o[e])return o[e];var r=[],a={regexp:j()(e,r,t),keys:r};return T<k&&(o[e]=a,T+=1),a}(n,{end:r,strict:i,sensitive:s}),a=o.regexp,c=o.keys,l=a.exec(e);if(!l)return null;var u=Object(E.a)(l),d=u[0],p=u.slice(1),h=e===d;return r&&!h?null:{path:n,url:"/"===n&&""===d?"/":d,isExact:h,params:c.reduce(function(e,t,n){return e[t.name]=p[n],e},{})}},null)},_=Object(w.a)(),S=function(e){var t=v.a.parse(e.search,!0).query;return Number(t&&t._||"0")},C=function(){return S(_.location)+1},D=function(e){return _.location.pathname!==e?[{path:"/"},{path:"".concat(_.location.pathname).concat(_.location.search)}]:[{path:"/"}]},R=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(d.a)(this,Object(p.a)(t).call(this,e))).popPage=function(e){_.goBack()},n.pushPage=function(e,t){var o,r=C();o=e.indexOf("?")>=0?"".concat(e,"&_=").concat(r):"".concat(e,"?_=").concat(r),n.navigator.current.pushPage({path:o},t),_.push(o)},n.handleHistoryChange=function(e,t){if("POP"===t){var o=S(n.lastLocation),r=S(e),a={path:"".concat(e.pathname).concat(e.search)};r>o?n.navigator.current.pushPage(a):r<o&&n.navigator.current.pages.length>1&&n.navigator.current.popPage()}n.lastLocation=e},n.renderPage=function(e,t){var o=e.path,a=n.props.routes,i=o.replace(/\?.*$/gi,""),c=null,s=null;return a.some(function(e){var t=P(i,e);return!!t&&(c=t,s=e.component,!0)}),s?r.a.createElement(s,{key:o,history:_,location:_.location,match:c,navigator:Object(m.a)(Object(m.a)(n))}):null},n.navigator=Object(o.createRef)(),n.lastLocation=_.location,n.initialRouteStack=D(e.root),n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){window.a=this.navigator.current,this.unlisten=_.listen(this.handleHistoryChange)}},{key:"componentWillUnmount",value:function(){"function"===typeof this.unlisten&&this.unlisten()}},{key:"render",value:function(){var e=this.props,t=(e.routes,e.initialRoute,Object(f.a)(e,["routes","initialRoute"]));return r.a.createElement(b.Navigator,Object.assign({},t,{ref:this.navigator,initialRouteStack:this.initialRouteStack,renderPage:this.renderPage}))}}]),t}(o.PureComponent);R.defaultProps={root:"/"};var x=R,L=n(52),M=n(6),N=n.n(M),I=function(e){var t=e.models,n=e.getInitialProps,a=e.mapStateToProps,i=e.mapDispatchToProps;return function(e){var c=Object(s.b)(a,i)(e),f=function(e){function o(e){var t;return Object(l.a)(this,o),(t=Object(d.a)(this,Object(p.a)(o).call(this,e))).state={mounted:!1},t.models=null,t}return Object(h.a)(o,e),Object(u.a)(o,[{key:"componentDidMount",value:function(){var e=this.context.store;e&&(this.models=Object.keys(t).reduce(function(n,o){var r=new t[o](Date.now());return e.model(r),n[o]=r,n},{}),n({props:this.props,store:e,models:this.models})),this.setState({mounted:!0})}},{key:"componentWillUnmount",value:function(){var e=this,t=this.context.store;t&&this.models&&t.unmodel(Object.keys(this.models).map(function(t){return e.models[t]}))}},{key:"render",value:function(){return this.state.mounted?r.a.createElement(c,Object.assign({},this.props,{models:this.models})):null}}]),o}(o.PureComponent);return f.displayName="createPage(".concat(e.displayName||e.name||"Page",")"),f.contextTypes={store:N.a.object},f}},H=n(51),A=n(82),W=new c.Schema("authors"),U=new c.Schema("topics",{author:W.entity}),B=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return Object(l.a)(this,t),(e=Object(d.a)(this,Object(p.a)(t).call(this,"TopicFeeds/".concat(n),{api:function(e){return A.loadTopicList("",e,15).then(function(t){return{data:t.map(function(e){var t=e.author,n=e.author_id,o=Object(f.a)(e,["author","author_id"]);return o.author=Object(H.a)({},t,{id:n}),o}),meta:{page:e,hasMore:t.length>0}}})},entities:c.entities,schema:U}))).getTopics=function(t){return e.getData(t).map(function(e){return U.getEntity(c.entities.getState(t),e)})},e}return Object(h.a)(t,e),t}(c.ListPage),F=n(61),q=n.n(F),z=n(11),G=n.n(z),J=n(174),K=n.n(J),$={},Q=function(e){var t=e.topic,n=Object(f.a)(e,["topic"]);return r.a.createElement("div",Object.assign({},n,{className:G()("card",{"card--material":q.a.platform.isAndroid()})}),r.a.createElement("div",{className:G()("card__title",{"card--material__title":q.a.platform.isAndroid()})},t.title),r.a.createElement("div",{className:G()("card__content",K.a.content,{"card--material__content":q.a.platform.isAndroid()})},function(e){if($[e])return $[e];var t=document.createElement("div");return t.innerHTML=e,$[e]=t.innerText,$[e]}(t.content)))},V=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(d.a)(this,Object(p.a)(t).call(this,e))).onPullHookChange=function(e){var t=e.state;n.setState({pullHookState:t})},n.onRefresh=function(e){n.refreshDone=e,n.props.onRefresh()},n.onLoadMore=function(){return n.props.onLoadMore(),new Promise(function(e){n.loadMoreDone=e})},n.isRowLoaded=function(e){return e.index<(n.props.topics?n.props.topics.length:0)},n.renderTopic=function(e){var t=e.key,o=e.index,a=e.parent,i=e.style,c=n.props.topics[o];return c?r.a.createElement(L.a,{key:t,cache:n.cache,columnIndex:0,parent:a,rowIndex:o},r.a.createElement("div",{style:i},r.a.createElement(Q,{onClick:function(){return n.props.navigator.pushPage("/topic/".concat(c.id))},topic:c}))):o>0?r.a.createElement("div",{key:t},"\u52a0\u8f7d\u4e2d..."):null},n.state={mounted:!1,pullHookState:"initial"},n.page=Object(o.createRef)(),n.pageContentEle=null,n.cache=new L.b({fixedWidth:!0,fixedHeight:!1}),n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=Object(a.findDOMNode)(this.page.current);if(e){var t=e.querySelector(".page__content");this.pageContentEle=t}this.setState({mounted:!0})}},{key:"componentDidUpdate",value:function(e,t){e.refreshing&&!this.props.refreshing&&(this.setState({pullHookState:"initial"}),this.refreshDone&&(this.refreshDone(),this.refreshDone=null)),e.moreLoading&&!this.props.moreLoading&&this.loadMoreDone&&(this.loadMoreDone(),this.loadMoreDone=null)}},{key:"render",value:function(){var e=this,t=this.props.topics,n=this.state,o=n.mounted,a=n.pullHookState;return r.a.createElement(b.Page,{ref:this.page,renderToolbar:function(){return r.a.createElement(b.Toolbar,null,r.a.createElement("div",{className:"left"},r.a.createElement(b.ToolbarButton,null,r.a.createElement(b.Icon,{icon:"md-menu"}))),r.a.createElement("div",{className:"center"},"CNode \u793e\u533a"))}},r.a.createElement(b.PullHook,{onChange:this.onPullHookChange,onLoad:this.onRefresh},"initial"===a?r.a.createElement("span",null,r.a.createElement(b.Icon,{size:35,spin:!1,icon:"ion-arrow-down-a"}),r.a.createElement("span",null,"\u4e0b\u62c9\u5237\u65b0")):"preaction"===a?r.a.createElement("span",null,r.a.createElement(b.Icon,{size:35,spin:!1,icon:"ion-arrow-up-a"}),r.a.createElement("span",null,"\u677e\u5f00\u5237\u65b0")):r.a.createElement("span",null,r.a.createElement(b.Icon,{size:35,spin:!0,icon:"ion-load-d"}),r.a.createElement("span",null,"\u52a0\u8f7d\u4e2d..."))),o?r.a.createElement(L.e,{scrollElement:this.pageContentEle},function(n){var o=n.height,a=n.width,i=n.isScrolling,c=n.registerChild,s=n.scrollTop;if(!o||!a)return null;var l=t?t.length+1:0;return r.a.createElement("div",{ref:c},r.a.createElement(L.c,{isRowLoaded:e.isRowLoaded,loadMoreRows:e.onLoadMore,rowCount:l},function(t){return r.a.createElement(L.d,{ref:t.registerChild,autoHeight:!0,deferredMeasurementCache:e.cache,height:o,width:a,isScrolling:i,onRowsRendered:t.onRowsRendered,rowCount:l,rowHeight:e.cache.rowHeight,rowRenderer:e.renderTopic,scrollTop:s})}))}):null)}}]),t}(o.PureComponent),X=I({models:{topicFeeds:B},getInitialProps:function(e){var t=e.store,n=e.models.topicFeeds;t.dispatch(n.actions.initiateIfNeed())},mapStateToProps:function(e,t){var n=t.models.topicFeeds,o=n.getInitiate(e),r=n.getLoadMore(e);return{topics:n.getTopics(e),hasMore:n.hasMore(e),moreLoadError:r.error,moreLoading:r.loading,refreshError:o.error,refreshing:o.loading}},mapDispatchToProps:function(e,t){var n=t.models.topicFeeds;return{onRefresh:function(){return e(n.actions.initiate())},onLoadMore:function(){return e(n.actions.loadMore())}}}})(V),Y=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return Object(l.a)(this,t),(e=Object(d.a)(this,Object(p.a)(t).call(this,"TopicDetail/".concat(n),{api:function(e){return A.loadTopicDetail(e).then(function(e){var t=e.author,n=e.author_id,o=Object(f.a)(e,["author","author_id"]);return{data:Object(H.a)({},o,{author:Object(H.a)({},t,{id:n})})}})},entities:c.entities,schema:U}))).getTopic=function(t){var n=c.entities.getState(t),o=e.getDetail(t);return Object(H.a)({},o,{author:o?W.getEntity(n,o.author):null})},e}return Object(h.a)(t,e),t}(c.DetailPage),Z=n(175),ee=n.n(Z),te=function(e){function t(){return Object(l.a)(this,t),Object(d.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:"renderTopic",value:function(e){return e?r.a.createElement(b.Card,{className:ee.a.topic},r.a.createElement("div",{className:"title"},e.title),r.a.createElement("div",{className:"content",dangerouslySetInnerHTML:{__html:e.content}})):null}},{key:"renderReplies",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return r.a.createElement("div",null,r.a.createElement(b.ListTitle,null,"".concat(e.length,"\u6761\u56de\u590d")),r.a.createElement(b.List,{dataSource:e,renderRow:function(e,t){return r.a.createElement(b.ListItem,{key:e.id},r.a.createElement("div",{dangerouslySetInnerHTML:{__html:e.content}}))}}))}},{key:"render",value:function(){var e=this.props,t=e.topic,n=e.navigator;return r.a.createElement(b.Page,{renderToolbar:function(){return r.a.createElement(b.Toolbar,null,r.a.createElement("div",{className:"left"},r.a.createElement(b.BackButton,{onClick:function(){return n.popPage()}},"\u8fd4\u56de")),r.a.createElement("div",{className:"center"},"\u8bdd\u9898"))}},t?this.renderTopic(t):null,t&&t.replies?this.renderReplies(t.replies):null)}}]),t}(o.PureComponent),ne=[{path:"/",component:X},{path:"/topic/:id",component:I({models:{topicDetail:Y},getInitialProps:function(e){var t=e.props.match,n=e.store,o=e.models.topicDetail;n.dispatch(o.actions.initiateIfNeed(t.params.id))},mapStateToProps:function(e,t){var n=t.models.topicDetail,o=n.getInitiate(e);return{topic:n.getTopic(e),refreshError:o.error,refreshing:o.loading}},mapDispatchToProps:function(e,t){var n=t.models.topicDetail;return{onRefresh:function(){return e(n.actions.initiate())}}}})(te)}],oe=function(e){function t(){return Object(l.a)(this,t),Object(d.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.a.createElement(x,{routes:ne})}}]),t}(o.PureComponent),re=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ae(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See http://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}var ie=Object(c.init)({});i.a.render(r.a.createElement(s.a,{store:ie},r.a.createElement(oe,null)),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/practice/cnodejs/react-redumd-onsen",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("/practice/cnodejs/react-redumd-onsen","/service-worker.js");re?(function(e,t){fetch(e).then(function(n){var o=n.headers.get("content-type");404===n.status||null!=o&&-1===o.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):ae(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit http://bit.ly/CRA-PWA")})):ae(t,e)})}}()},82:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){return localStorage.setItem("cnodejs.practice.com.ACCESS_TOKEN",e)},r=t.getAccessToken=function(){return localStorage.getItem("cnodejs.practice.com.ACCESS_TOKEN")},a=t.request=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{method:"GET"},n=arguments[2],o="https://cnodejs.org/api/v1"+e,a=r();return"GET"===t.method&&a&&(o+=(o.indexOf("?")>=0?"&":"?")+"accesstoken="+a),fetch(o,t).then(function(e){if(!/application\/json/.test(e.headers.get("Content-Type")))throw new Error("\u7cfb\u7edf\u9519\u8bef");return e.json()}).then(function(e){if(n)return e;var t=e.success,o=e.error_msg,r=e.data;if(!t)throw new Error(o);return r})};t.loadTopicList=function(e,t,n){return a("/topics?page="+t+"&limit="+n+(e?"&tab="+e:""))},t.loadTopicDetail=function(e){return a("/topic/"+e)},t.collectTopic=function(e,t){return a("/topic_collect/"+(t?"collect":"de_collect"),{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"accesstoken="+r()+"&topic_id="+e},!0).then(function(e){var t=e.success,n=e.error_msg;if(!t&&n)throw new Error(n);return e})},t.likeReply=function(e){return a("/reply/"+e+"/ups",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"accesstoken="+r()},!0).then(function(e){var t=e.success,n=e.error_msg,o=e.action;if(!t&&n)throw new Error(n);return o})},t.loadUserDetail=function(e){return a("/user/"+e)},t.loadUserCollections=function(e){return a("/topic_collect/"+e)},t.loadMessages=function(){return a("/messages")},t.markMessage=function(e){return a("/message/mark_one/"+e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"accesstoken="+r()})},t.markAllMessage=function(e){return a("message/mark_all",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"accesstoken="+r()})};t.login=function(e){return a("/accesstoken",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"accesstoken="+e},!0).then(function(t){var n=t.success,r=t.error_msg,a=function(e,t){var n={};for(var o in e)t.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}(t,["success","error_msg"]);if(!n)throw new Error(r);return o(e),a})};t.logout=function(){return o("")}}},[[178,2,1]]]);
//# sourceMappingURL=main.f1c49f11.chunk.js.map