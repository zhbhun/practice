(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{128:function(e,t,n){e.exports={topicFeedsItemContent:"Home_topicFeedsItemContent__1xFDG"}},129:function(e,t,n){e.exports=n(248)},234:function(e,t,n){},248:function(e,t,n){"use strict";n.r(t);var o=n(1),r=n.n(o),a=n(87),i=n.n(a),c=n(7),s=n(56),l=(n(234),n(8)),u=n(21),d=n(10),p=n(9),h=n(11),m=n(3),f=(n(239),n(245),n(127)),g=n.n(f),v=n(6),b=n.n(v),w=function(e){var t=e.models,n=e.getInitialProps,a=e.mapStateToProps,i=e.mapDispatchToProps;return function(e){var c=Object(s.b)(a,i)(e),m=function(e){function o(e){var t;return Object(l.a)(this,o),(t=Object(d.a)(this,Object(p.a)(o).call(this,e))).state={mounted:!1},t.models=null,t}return Object(h.a)(o,e),Object(u.a)(o,[{key:"componentDidMount",value:function(){var e=this.context.store;e&&(this.models=Object.keys(t).reduce(function(n,o){var r=new t[o](Date.now());return e.model(r),n[o]=r,n},{}),n({props:this.props,store:e,models:this.models})),this.setState({mounted:!0})}},{key:"componentWillUnmount",value:function(){var e=this,t=this.context.store;t&&this.models&&t.unmodel(Object.keys(this.models).map(function(t){return e.models[t]}))}},{key:"render",value:function(){return this.state.mounted?r.a.createElement(c,Object.assign({},this.props,{models:this.models})):null}}]),o}(o.PureComponent);return m.displayName="createPage(".concat(e.displayName||e.name||"Page",")"),m.contextTypes={store:b.a.object},m}},E={},O=function(e){if(E[e])return E[e];var t=document.createElement("div");return t.innerHTML=e,E[e]=t.innerText,E[e]},j=n(36),T=n(57),y=n(55),k=new c.Schema("authors"),P=new c.Schema("topics",{author:k.entity}),S=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return Object(l.a)(this,t),(e=Object(d.a)(this,Object(p.a)(t).call(this,"TopicFeeds/".concat(n),{api:function(e){return y.loadTopicList("",e,15).then(function(t){return{data:t.map(function(e){var t=e.author,n=e.author_id,o=Object(T.a)(e,["author","author_id"]);return o.author=Object(j.a)({},t,{id:n}),o}),meta:{page:e,hasMore:t.length>0}}})},entities:c.entities,schema:P}))).getTopics=function(t){return e.getData(t).map(function(e){return P.getEntity(c.entities.getState(t),e)})},e}return Object(h.a)(t,e),t}(c.ListPage),C=n(128),D=n.n(C),_=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(d.a)(this,Object(p.a)(t).call(this,e))).onPullHookChange=function(e){var t=e.state;n.setState({pullHookState:t})},n.onRefresh=function(e){n.refreshDone=e,n.props.onRefresh()},n.onLoadMore=function(e){n.loadMoreDone=e,n.props.onLoadMore()},n.renderTopic=function(e,t){return r.a.createElement(m.Card,{key:e.id,onClick:function(){return n.props.navigator.pushPage({path:"/topic",passProps:{id:e.id}})}},r.a.createElement("div",{className:"title"},e.title),r.a.createElement("div",{className:g()("content",D.a.topicFeedsItemContent)},O(e.content)))},n.state={pullHookState:"initial"},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidUpdate",value:function(e,t){e.refreshing&&!this.props.refreshing&&(this.setState({pullHookState:"initial"}),this.refreshDone&&(this.refreshDone(),this.refreshDone=null)),e.moreLoading&&!this.props.moreLoading&&this.loadMoreDone&&(this.loadMoreDone(),this.loadMoreDone=null)}},{key:"render",value:function(){var e=this.props.topics,t=this.state.pullHookState;return r.a.createElement(m.Page,{renderToolbar:function(){return r.a.createElement(m.Toolbar,null,r.a.createElement("div",{className:"left"},r.a.createElement(m.ToolbarButton,null,r.a.createElement(m.Icon,{icon:"md-menu"}))),r.a.createElement("div",{className:"center"},"CNode \u793e\u533a"))},onInfiniteScroll:this.onLoadMore},r.a.createElement(m.PullHook,{onChange:this.onPullHookChange,onLoad:this.onRefresh},"initial"===t?r.a.createElement("span",null,r.a.createElement(m.Icon,{size:35,spin:!1,icon:"ion-arrow-down-a"}),r.a.createElement("span",null,"\u4e0b\u62c9\u5237\u65b0")):"preaction"===t?r.a.createElement("span",null,r.a.createElement(m.Icon,{size:35,spin:!1,icon:"ion-arrow-up-a"}),r.a.createElement("span",null,"\u677e\u5f00\u5237\u65b0")):r.a.createElement("span",null,r.a.createElement(m.Icon,{size:35,spin:!0,icon:"ion-load-d"}),r.a.createElement("span",null,"\u52a0\u8f7d\u4e2d..."))),r.a.createElement(m.List,{dataSource:e||[],renderRow:this.renderTopic}))}}]),t}(o.PureComponent),L=w({models:{topicFeeds:S},getInitialProps:function(e){var t=e.store,n=e.models.topicFeeds;t.dispatch(n.actions.initiateIfNeed())},mapStateToProps:function(e,t){var n=t.models.topicFeeds,o=n.getInitiate(e),r=n.getLoadMore(e);return{topics:n.getTopics(e),hasMore:n.hasMore(e),moreLoadError:r.error,moreLoading:r.loading,refreshError:o.error,refreshing:o.loading}},mapDispatchToProps:function(e,t){var n=t.models.topicFeeds;return{onRefresh:function(){return e(n.actions.initiate())},onLoadMore:function(){return e(n.actions.loadMore())}}}})(_),I=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return Object(l.a)(this,t),(e=Object(d.a)(this,Object(p.a)(t).call(this,"TopicDetail/".concat(n),{api:function(e){return y.loadTopicDetail(e).then(function(e){var t=e.author,n=e.author_id,o=Object(T.a)(e,["author","author_id"]);return{data:Object(j.a)({},o,{author:Object(j.a)({},t,{id:n})})}})},entities:c.entities,schema:P}))).getTopic=function(t){var n=c.entities.getState(t),o=e.getDetail(t);return Object(j.a)({},o,{author:o?k.getEntity(n,o.author):null})},e}return Object(h.a)(t,e),t}(c.DetailPage),M=function(e){function t(){return Object(l.a)(this,t),Object(d.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:"renderTopic",value:function(e){return e?r.a.createElement(m.Card,null,r.a.createElement("div",{className:"title"},e.title),r.a.createElement("div",{className:"content",dangerouslySetInnerHTML:{__html:e.content}})):null}},{key:"renderReplies",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return r.a.createElement("div",null,r.a.createElement(m.ListTitle,null,"".concat(e.length,"\u6761\u56de\u590d")),r.a.createElement(m.List,{dataSource:e,renderRow:function(e,t){return r.a.createElement(m.ListItem,{key:e.id},r.a.createElement("div",{dangerouslySetInnerHTML:{__html:e.content}}))}}))}},{key:"render",value:function(){var e=this.props.topic;return r.a.createElement(m.Page,{renderToolbar:function(){return r.a.createElement(m.Toolbar,null,r.a.createElement("div",{className:"left"},r.a.createElement(m.BackButton,null,"\u8fd4\u56de")),r.a.createElement("div",{className:"center"},"\u8bdd\u9898"))}},e?this.renderTopic(e):null,e&&e.replies?this.renderReplies(e.replies):null)}}]),t}(o.PureComponent),N=w({models:{topicDetail:I},getInitialProps:function(e){var t=e.props.id,n=e.store,o=e.models.topicDetail;n.dispatch(o.actions.initiateIfNeed(t))},mapStateToProps:function(e,t){var n=t.models.topicDetail,o=n.getInitiate(e);return{topic:n.getTopic(e),refreshError:o.error,refreshing:o.loading}},mapDispatchToProps:function(e,t){var n=t.models.topicDetail;return{onRefresh:function(){return e(n.actions.initiate())}}}})(M),x={path:"/"},R=function(e){function t(){var e,n;Object(l.a)(this,t);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(a)))).handleClick=function(){},n.renderPage=function(e,t){var n=e.path,o=e.passProps,a=void 0===o?{}:o;return"/"===n?r.a.createElement(L,Object.assign({},a,{key:n,navigator:t})):"/topic"===n?r.a.createElement(N,Object.assign({},a,{key:n,navigator:t})):null},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.a.createElement(m.Navigator,{renderPage:this.renderPage,initialRoute:x})}}]),t}(o.PureComponent),H=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function A(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See http://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}var F=Object(c.init)({});i.a.render(r.a.createElement(s.a,{store:F},r.a.createElement(R,null)),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/practice/cnodejs/react-redumd-onsen",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("/practice/cnodejs/react-redumd-onsen","/service-worker.js");H?(function(e,t){fetch(e).then(function(n){var o=n.headers.get("content-type");404===n.status||null!=o&&-1===o.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):A(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit http://bit.ly/CRA-PWA")})):A(t,e)})}}()},55:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){return localStorage.setItem("cnodejs.practice.com.ACCESS_TOKEN",e)},r=t.getAccessToken=function(){return localStorage.getItem("cnodejs.practice.com.ACCESS_TOKEN")},a=t.request=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{method:"GET"},n=arguments[2],o="https://cnodejs.org/api/v1"+e,a=r();return"GET"===t.method&&a&&(o+=(o.indexOf("?")>=0?"&":"?")+"accesstoken="+a),fetch(o,t).then(function(e){if(!/application\/json/.test(e.headers.get("Content-Type")))throw new Error("\u7cfb\u7edf\u9519\u8bef");return e.json()}).then(function(e){if(n)return e;var t=e.success,o=e.error_msg,r=e.data;if(!t)throw new Error(o);return r})};t.loadTopicList=function(e,t,n){return a("/topics?page="+t+"&limit="+n+(e?"&tab="+e:""))},t.loadTopicDetail=function(e){return a("/topic/"+e)},t.collectTopic=function(e,t){return a("/topic_collect/"+(t?"collect":"de_collect"),{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"accesstoken="+r()+"&topic_id="+e},!0).then(function(e){var t=e.success,n=e.error_msg;if(!t&&n)throw new Error(n);return e})},t.likeReply=function(e){return a("/reply/"+e+"/ups",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"accesstoken="+r()},!0).then(function(e){var t=e.success,n=e.error_msg,o=e.action;if(!t&&n)throw new Error(n);return o})},t.loadUserDetail=function(e){return a("/user/"+e)},t.loadUserCollections=function(e){return a("/topic_collect/"+e)},t.loadMessages=function(){return a("/messages")},t.markMessage=function(e){return a("/message/mark_one/"+e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"accesstoken="+r()})},t.markAllMessage=function(e){return a("message/mark_all",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"accesstoken="+r()})};t.login=function(e){return a("/accesstoken",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"accesstoken="+e},!0).then(function(t){var n=t.success,r=t.error_msg,a=function(e,t){var n={};for(var o in e)t.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}(t,["success","error_msg"]);if(!n)throw new Error(r);return o(e),a})};t.logout=function(){return o("")}}},[[129,2,1]]]);
//# sourceMappingURL=main.66ec2a02.chunk.js.map